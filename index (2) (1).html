<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bob the Stickman Games</title>
<style>
    body { font-family: Arial, sans-serif; background-color: #c4c4c4; color: #333; margin: 0; padding: 0;}
    header { background-color: #556B2F; color: white; padding: 15px; text-align: center; }
    nav { background-color: #8B4513; padding: 10px; display: flex; gap: 10px; justify-content: center; }
    nav button { padding: 8px 12px; cursor: pointer; background-color: orange; border: none; color: white; border-radius: 5px; }
    main { padding: 20px; }
    section { margin-bottom: 30px; }
    h2 { color: #556B2F; }
    .game-card { border: 1px solid #333; padding: 10px; margin-bottom: 10px; background-color: #eee; border-radius: 5px; }
    .hidden { display: none; }
    input, textarea { padding: 5px; margin: 5px 0; width: 100%; }
    .member-only { color: red; font-weight: bold; }
    iframe { width: 100%; height: 400px; }
    .rating { display: flex; gap: 5px; cursor: pointer; }
    .star { font-size: 20px; color: gray; }
    .star.selected { color: gold; }
</style>
</head>
<body>

<header>
    <h1>Bob the Stickman Games</h1>
</header>

<nav>
    <button onclick="showSection('home')">Home</button>
    <button onclick="showSection('addGame')">Add Game</button>
    <button onclick="showSection('membership')">Membership</button>
    <button onclick="adminLogin()">Admin</button>
</nav>

<main>
    <!-- Home / Approved Games -->
    <section id="home">
        <h2>Approved Games</h2>
        <div id="gamesList"></div>
    </section>

    <!-- Add Game Section -->
    <section id="addGame" class="hidden">
        <h2>Add a Game</h2>
        <div id="notMemberNotice" class="member-only hidden">You need to be a member to post a game.</div>
        <div id="gameFormDiv">
            <input type="text" id="gameName" placeholder="Game Name">
            <input type="text" id="gameLink" placeholder="Game Link or embed code">
            <textarea id="gameMessage" placeholder="Message to admin"></textarea>
            <button onclick="submitGame()">Submit Game for Approval</button>
        </div>
    </section>

    <!-- Membership Section -->
    <section id="membership" class="hidden">
        <h2>Become a Member</h2>
        <input type="text" id="memberName" placeholder="Full Name">
        <input type="email" id="memberEmail" placeholder="Email (required)">
        <input type="text" id="memberUsername" placeholder="Username">
        <textarea id="memberAbout" placeholder="About you"></textarea>
        <button onclick="registerMember()">Register</button>
    </section>

    <!-- Admin Section -->
    <section id="admin" class="hidden">
        <h2>Admin Panel</h2>
        <h3>Pending Games</h3>
        <div id="pendingGamesList"></div>
        <h3>Members</h3>
        <div id="membersList"></div>
    </section>
</main>

<script>
let currentMember = null;

// Utility functions
function showSection(id) {
    document.querySelectorAll('main section').forEach(sec => sec.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');

    if(id === 'addGame') checkMembership();
    if(id === 'home') renderGames();
    if(id === 'admin') renderAdmin();
}

function adminLogin() {
    let pass = prompt("Enter admin passcode:");
    if(pass === "stego") {
        showSection('admin');
    } else {
        alert("Wrong passcode!");
    }
}

// Membership
function registerMember() {
    let name = document.getElementById('memberName').value;
    let email = document.getElementById('memberEmail').value;
    let username = document.getElementById('memberUsername').value;
    let about = document.getElementById('memberAbout').value;
    if(!email) { alert("Email required!"); return; }

    let members = JSON.parse(localStorage.getItem('members') || '[]');
    let member = {name,email,username,about,plays:0,ratings:{}};
    members.push(member);
    localStorage.setItem('members', JSON.stringify(members));
    currentMember = username;
    alert("Registered successfully! You are now a member.");
    document.getElementById('membership').classList.add('hidden');
}

function checkMembership() {
    let members = JSON.parse(localStorage.getItem('members') || '[]');
    if(!currentMember) {
        document.getElementById('notMemberNotice').classList.remove('hidden');
        document.getElementById('gameFormDiv').classList.add('hidden');
    } else {
        document.getElementById('notMemberNotice').classList.add('hidden');
        document.getElementById('gameFormDiv').classList.remove('hidden');
    }
}

// Game Submission
function submitGame() {
    let name = document.getElementById('gameName').value;
    let link = document.getElementById('gameLink').value;
    let message = document.getElementById('gameMessage').value;

    if(!name || !link) { alert("Game name and link required!"); return; }

    let pending = JSON.parse(localStorage.getItem('pendingGames') || '[]');
    pending.push({name,link,message,submittedBy:currentMember});
    localStorage.setItem('pendingGames', JSON.stringify(pending));

    alert("Game submitted for admin approval!");
    document.getElementById('gameName').value = "";
    document.getElementById('gameLink').value = "";
    document.getElementById('gameMessage').value = "";
}

// Render Games on Home
function renderGames() {
    let games = JSON.parse(localStorage.getItem('approvedGames') || '[]');
    let container = document.getElementById('gamesList');
    container.innerHTML = '';
    games.forEach((g,i)=>{
        let div = document.createElement('div');
        div.classList.add('game-card');
        div.innerHTML = `<h4>${g.name}</h4><iframe src="${g.link}"></iframe>`;
        if(currentMember) {
            let stars = document.createElement('div');
            stars.classList.add('rating');
            for(let s=1;s<=5;s++){
                let star = document.createElement('span');
                star.classList.add('star');
                star.innerHTML = 'â˜…';
                star.onclick = ()=> rateGame(i,s);
                if(g.ratings && g.ratings[currentMember]>=s) star.classList.add('selected');
                stars.appendChild(star);
            }
            div.appendChild(stars);
        }
        container.appendChild(div);
    });
}

// Rating
function rateGame(index, rating) {
    let games = JSON.parse(localStorage.getItem('approvedGames') || '[]');
    if(!currentMember) return;
    if(!games[index].ratings) games[index].ratings={};
    games[index].ratings[currentMember] = rating;
    localStorage.setItem('approvedGames', JSON.stringify(games));
    renderGames();
}

// Admin Panel
function renderAdmin() {
    // Pending Games
    let pending = JSON.parse(localStorage.getItem('pendingGames') || '[]');
    let pendingDiv = document.getElementById('pendingGamesList');
    pendingDiv.innerHTML = '';
    pending.forEach((g,i)=>{
        let div = document.createElement('div');
        div.classList.add('game-card');
        div.innerHTML = `<h4>${g.name}</h4><p>${g.message}</p><iframe src="${g.link}"></iframe>
        <button onclick="approveGame(${i})">Approve</button>
        <button onclick="rejectGame(${i})">Reject</button>`;
        pendingDiv.appendChild(div);
    });

    // Members
    let members = JSON.parse(localStorage.getItem('members') || '[]');
    let membersDiv = document.getElementById('membersList');
    membersDiv.innerHTML = '';
    members.forEach((m,i)=>{
        let div = document.createElement('div');
        div.classList.add('game-card');
        div.innerHTML = `<h4>${m.username}</h4><p>Name: ${m.name}</p><p>Email: ${m.email}</p>
        <p>About: ${m.about}</p><p>Plays: ${m.plays}</p>
        <button onclick="kickMember(${i})">Kick Member</button>`;
        membersDiv.appendChild(div);
    });
}

function approveGame(i) {
    let pending = JSON.parse(localStorage.getItem('pendingGames') || '[]');
    let approved = JSON.parse(localStorage.getItem('approvedGames') || '[]');
    approved.push(pending[i]);
    pending.splice(i,1);
    localStorage.setItem('pendingGames', JSON.stringify(pending));
    localStorage.setItem('approvedGames', JSON.stringify(approved));
    renderAdmin();
}

function rejectGame(i) {
    let pending = JSON.parse(localStorage.getItem('pendingGames') || '[]');
    pending.splice(i,1);
    localStorage.setItem('pendingGames', JSON.stringify(pending));
    renderAdmin();
}

function kickMember(i) {
    let members = JSON.parse(localStorage.getItem('members') || '[]');
    let username = members[i].username;

    members.splice(i,1);
    localStorage.setItem('members', JSON.stringify(members));

    // Remove ratings and submitted games by this member
    let approved = JSON.parse(localStorage.getItem('approvedGames') || '[]');
    approved.forEach(g=>{
        if(g.ratings && g.ratings[username]) delete g.ratings[username];
    });
    localStorage.setItem('approvedGames', JSON.stringify(approved));

    let pending = JSON.parse(localStorage.getItem('pendingGames') || '[]');
    pending = pending.filter(g => g.submittedBy !== username);
    localStorage.setItem('pendingGames', JSON.stringify(pending));

    renderAdmin();
}

</script>

</body>
</html>
